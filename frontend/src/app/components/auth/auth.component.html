@if (showSuccessBanner || bannerAnimatingOut) {
  <div class="successBanner fixed top-10 left-0 m-0 w-full z-50 flex justify-center" style="pointer-events: none;">
    <div [ngClass]="{
      'success-banner-anim-in': showSuccessBanner && !bannerAnimatingOut,
      'success-banner-anim-out': bannerAnimatingOut
    }"
    class="bg-green-600 text-white p-0 rounded-2xl shadow-lg flex flex-col items-center w-full h-12 max-w-2xl align-center"
    style="pointer-events: auto;">
      <div class="w-[95%] h-1 m-0 p-0 bg-green-800 rounded-full overflow-hidden">
        <div class="h-full bg-green-300 transition-all duration-100" [style.width.%]="successBannerProgress"></div>
      </div>
      <div class="successMessage w-full flex justify-center items-center p-0 m-0">
        <span class=" font-semibold text-lg !mt-1 p-0">{{ successBannerMessage }}</span>
      </div>

    </div>
  </div>
}

<div class="auth-container">
  <div class="auth-wrapper glass !overflow-y-auto !min-h-fit">
    <!-- Left Side - Branding -->
    <div class="branding-section">
      <div class="branding-content h-full">
        <div *ngIf="!responsive" [innerHTML]="logos.get('Rarecips_Iconologo2')" class="logo"></div>
        <p *ngIf="!responsive" class="brand-subtitle">
          {{ t('brand_subtitle') }}
        </p>

        <!-- Floating Recipe Cards -->
        <div class="floating-preview-cards">
          <div class="preview-card glass-strong">
            <div class="preview-image preview-image-1"></div>
            <div class="preview-content">
              <h4>Pasta Carbonara</h4>
              <div class="preview-rating">
                <span class="stars">★★★★★</span>
                <span class="rating-text">4.8</span>
              </div>
            </div>
          </div>

          <div class="preview-card glass-strong">
            <div class="preview-image preview-image-2"></div>
            <div class="preview-content">
              <h4>Thai Curry</h4>
              <div class="preview-rating">
                <span class="stars">★★★★☆</span>
                <span class="rating-text">4.6</span>
              </div>
            </div>
          </div>

          <div class="preview-card glass-strong">
            <div class="preview-image preview-image-3"></div>
            <div class="preview-content">
              <h4>Chocolate Cake</h4>
              <div class="preview-rating">
                <span class="stars">★★★★★</span>
                <span class="rating-text">4.9</span>
              </div>
            </div>
          </div>

          <div class="preview-card glass-strong">
            <div class="preview-image preview-image-4"></div>
            <div class="preview-content">
              <h4>Pizza Margherita</h4>
              <div class="preview-rating">
                <span class="stars">★★★★☆</span>
                <span class="rating-text">4.7</span>
              </div>
            </div>
          </div>

          <div class="preview-card glass-strong">
            <div class="preview-image preview-image-5"></div>
            <div class="preview-content">
              <h4>Sushi Roll</h4>
              <div class="preview-rating">
                <span class="stars">★★★★★</span>
                <span class="rating-text">4.9</span>
              </div>
            </div>
          </div>

          <div class="preview-card glass-strong">
            <div class="preview-image preview-image-6"></div>
            <div class="preview-content">
              <h4>Paella Valenciana</h4>
              <div class="preview-rating">
                <span class="stars">★★★★★</span>
                <span class="rating-text">4.8</span>
              </div>
            </div>
          </div>

          <div class="preview-card glass-strong">
            <div class="preview-image preview-image-7"></div>
            <div class="preview-content">
              <h4>Ramen Japonés</h4>
              <div class="preview-rating">
                <span class="stars">★★★★☆</span>
                <span class="rating-text">4.5</span>
              </div>
            </div>
          </div>

          <div class="preview-card glass-strong">
            <div class="preview-image preview-image-8"></div>
            <div class="preview-content">
              <h4>Tacos Mexicanos</h4>
              <div class="preview-rating">
                <span class="stars">★★★★★</span>
                <span class="rating-text">4.7</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Side - Auth Forms -->
    <div class="auth-tab-container">
      <!-- Tab Navigation -->
      <div class="auth-tabs glass gap-2">
        <button class="auth-tab login-tab" [class.active]="activeTab === 'login'" (click)="switchTab('login')">
          <i class="ti ti-login text-xl" aria-hidden="true"></i>
          {{ t('login') }}
        </button>
        <button class="auth-tab signup-tab" style="color: var(--primary-700)" [class.active]="activeTab === 'signup'"
                (click)="switchTab('signup')">
          <i class="ti ti-user-plus text-xl" aria-hidden="true"></i>
          {{ t('register') }}
        </button>
      </div>
      <div class="auth-section">
        <div class="auth-forms-container">

          <!-- Login Form -->
          <div class="auth-form glass" [class.active]="activeTab === 'login'"
               [class.hidden]="activeTab !== 'login'">
            <div *ngIf="responsive" [innerHTML]="logos.get('Rarecips_Iconologo2')" class="logo flex justify-center w-full max-h-[8rem] [&>svg]:max-w-[8rem]"></div>
            <div class="form-header">
              <h2 class="form-title">
                {{ t('welcome_back') }}
              </h2>
              <p class="form-subtitle">
                {{ t('login_subtitle') }}
              </p>
            </div>

            <form class="form-content" (ngSubmit)="onLogin()" [attr.autocomplete]="localStorage.getItem('rememberMe') ? 'on' : 'off'">
              <div class="form-group">
                <label for="login-username" class="form-label">{{ t('username') }}</label>
                <div class="input-wrapper mb-3">
                  <i class="ti ti-at text-xl" style="color: var(--primary-700)" aria-hidden="true"></i>
                  <input type="text" id="login-username" class="form-input glass-input"
                         [placeholder]="t('username')" [(ngModel)]="loginForm.username" name="username" required
                         autocomplete="username">
                </div>
              </div>

              <div class="form-group">
                <label for="login-password" class="form-label">{{ t('password') }}</label>
                <div class="input-wrapper">
                  <i class="ti ti-lock text-xl" style="color: var(--primary-700)" aria-hidden="true"></i>
                  <input [type]="showLoginPassword ? 'text' : 'password'" id="login-password"
                         class="form-input glass-input" [placeholder]="t('password_placeholder')"
                         [(ngModel)]="loginForm.password" name="password" required
                         autocomplete="password">
                  <button type="button" class="password-toggle"
                    (pointerdown)="showLoginPassword = true"
                    (pointerup)="showLoginPassword = false"
                    (pointerleave)="showLoginPassword = false"
                    (pointercancel)="showLoginPassword = false">
                    @if (!showLoginPassword) {
                      <i class="ti ti-eye text-xl" style="color: var(--primary-700)" aria-hidden="true"></i>
                    }
                    @if (showLoginPassword) {
                      <i class="ti ti-eye-off text-xl" style="color: var(--primary-700)" aria-hidden="true"></i>
                    }
                  </button>
                </div>
              </div>

              <div class="credErrorMsg hidden text-red-500 flex justify-center"></div>

              <div class="form-options">
                <label class="checkbox-wrapper">
                  <input type="checkbox" class="form-checkbox" [(ngModel)]="loginForm.rememberMe"
                         name="rememberMe">
                  <span class="checkbox-custom glass-input"></span>
                  <span class="checkbox-label">{{ t('remember_me') }}</span>
                </label>
                <a href="#" class="forgot-link" (click)="onForgotPassword($event)">{{ t('forgot_password') }}</a>
              </div>

              <button type="submit" class="form-submit glass-button" id="loginBut">
                <div *ngIf="!loginLoad">
                  <i class="ti ti-login text-xl" aria-hidden="true"></i>
                  {{ t('login') }}
                </div>
                <div *ngIf="loginLoad" class="w-7 h-7">
                  <div [innerHTML]="logos.get('Rarecips_Spinner')"></div>
                </div>
              </button>
            </form>
          </div>

          <!-- signup Form -->
          <div class="auth-form glass" [class.active]="activeTab === 'signup'"
               [class.hidden]="activeTab !== 'signup'">
            <div class="form-header">
              <div *ngIf="responsive" [innerHTML]="logos.get('Rarecips_Iconologo2')" class="logo flex justify-center w-full max-h-[8rem] [&>svg]:max-w-[8rem]"></div>
              <h2 class="form-title">
                {{ t('join_rarecips') }}
              </h2>
              <p class="form-subtitle">{{ t('signup_subtitle') }}</p>
            </div>

            <form class="form-content" (ngSubmit)="onSignup()">
              <div class="form-group">
                <label for="signup-username" class="form-label">{{ t('username') }}</label>
                <div class="input-wrapper mb-2">
                  <i class="ti ti-at text-xl" style="color: var(--primary-700)" aria-hidden="true"></i>
                  <input type="text" id="signup-username" class="form-input glass-input"
                         [placeholder]="t('username_placeholder')" [(ngModel)]="signupForm.username"
                         (change)="onUsernameInput(signupUsernameInput.value)"
                         name="username" required
                         #signupUsernameInput>
                </div>
                <div class="username-status ml-8 hidden fixed mt-20">
                  @if (isUsernameAvailable != null) {
                    @if (isUsernameAvailable === true) {
                      <small class="text-success" style="color: green;">{{ t('nickname_available') }}</small>
                    } @else {
                      <small class="text-danger" style="color: red;">{{ t('nickname_not_available') }}</small>
                    }
                  } @else {
                    <small class="text-muted" style="color: gray;">{{ t('checking_availability') }}</small>
                  }
                </div>
              </div>

              <div class="form-group">
                <label for="signup-email" class="form-label">{{ t('email') }}</label>
                <div class="input-wrapper">
                  <i class="ti ti-mail text-xl" style="color: var(--primary-700)" aria-hidden="true"></i>
                  <input type="email" id="signup-email" class="form-input glass-input"
                         [placeholder]="t('email_placeholder')" [(ngModel)]="signupForm.email" name="email"
                         required>
                </div>
              </div>

              <div class="emailErrorMsg text-red-500 flex justify-center absolute top-[21.5rem] left-16"></div>

              <div class="form-group">
                <label for="signup-password" class="form-label">{{ t('password') }}</label>
                <div class="input-wrapper">
                  <i class="ti ti-lock text-xl" style="color: var(--primary-700)" aria-hidden="true"></i>
                  <input [type]="showSignupPassword ? 'text' : 'password'" id="signup-password"
                         class="form-input glass-input" [placeholder]="t('password_placeholder')"
                         [(ngModel)]="signupForm.password" (ngModelChange)="onPasswordInput($event)" name="password" required>
                  <button type="button" class="password-toggle"
  (pointerdown)="showSignupPassword = true"
  (pointerup)="showSignupPassword = false"
  (pointerleave)="showSignupPassword = false"
  (pointercancel)="showSignupPassword = false">
                    @if (!showSignupPassword) {
                      <i class="ti ti-eye text-xl" style="color: var(--primary-700)" aria-hidden="true"></i>
                    }
                    @if (showSignupPassword) {
                      <i class="ti ti-eye-off text-xl" style="color: var(--primary-700)" aria-hidden="true"></i>
                    }
                  </button>
                </div>

                <div class="password-strength-wrapper"
                     (mouseenter)="showPasswordRequirements = true" (mouseleave)="showPasswordRequirements = false">
                  <div class="flex flex-row items-center gap-4">
                    <div class="strength-track !w-2/4">
                      <div class="strength-bar" [style.width.%]="strengthPercent"
                           [style.background]="strengthColor"></div>
                    </div>
                    <div class="strength-info !w-1/4 flex items-center justify-center">
                      <span class="strength-label">{{ strengthLabel || "..." }}</span>
                      <i class="ti ti-info-circle password-info" aria-hidden="true"></i>
                    </div>
                  </div>

                  <div class="password-requirements" [class.visible]="showPasswordRequirements" role="dialog">
                    <ul>
                      <li [class.ok]="strengthCriteria.length">{{ t('min_8_chars') }}</li>
                      <li [class.ok]="strengthCriteria.lower">{{ t('lowercase_letter') }}</li>
                      <li [class.ok]="strengthCriteria.upper">{{ t('uppercase_letter') }}</li>
                      <li [class.ok]="strengthCriteria.number">{{ t('number_0_9') }}</li>
                      <li [class.ok]="strengthCriteria.special">{{ t('special_char') }}</li>
                    </ul>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="signup-confirm-password" class="form-label">{{ t('confirm_password') }}</label>
                <div class="input-wrapper">
                  <i class="ti ti-lock-check text-xl" style="color: var(--primary-700)" aria-hidden="true"></i>
                  <input [type]="showConfirmPassword ? 'text' : 'password'"
                         id="signup-confirm-password" class="form-input glass-input"
                         [placeholder]="t('confirm_password_placeholder')" [(ngModel)]="signupForm.confirmPassword"
                         (ngModelChange)="onConfirmPasswordInput($event)"
                         name="confirmPassword" required>
                  <button type="button" class="password-toggle"
                    (pointerdown)="showConfirmPassword = true"
                    (pointerup)="showConfirmPassword = false"
                    (pointerleave)="showConfirmPassword = false"
                    (pointercancel)="showConfirmPassword = false">
                    @if (!showConfirmPassword) {
                      <i class="ti ti-eye text-xl" style="color: var(--primary-700)" aria-hidden="true"></i>
                    }
                    @if (showConfirmPassword) {
                      <i class="ti ti-eye-off text-xl" style="color: var(--primary-700)" aria-hidden="true"></i>
                    }
                  </button>
                </div>
                <div class="password-status hidden absolute bottom-[calc(19%)] left-16">
                  <small class="text-danger" style="color: red;">{{ t('passwords_do_not_match') }}</small>
                </div>
              </div>

              <div class="form-options">
                <label class="checkbox-wrapper">
                  <input type="checkbox" class="form-checkbox" [(ngModel)]="signupForm.acceptTerms"
                         name="acceptTerms" required>
                  <span class="checkbox-custom glass-input"></span>
                  <span class="checkbox-label">
                    {{ t('accept_terms') }} <a href="#" class="terms-link">{{ t('terms_and_conditions') }}</a> {{ t('and') }}
                    <a href="#" class="terms-link">{{ t('privacy_policy') }}</a>
                  </span>
                </label>
              </div>

              <button type="submit" [disabled]="isSignupDisabled()" id="signupBut" class="form-submit glass-button">
                <div *ngIf="!signupLoad" class="flex flex-row gap-2 items-center justify-center">
                  <i class="ti ti-user-plus text-xl" aria-hidden="true"></i>
                  {{ t('create_account') }}
                </div>
                <div *ngIf="signupLoad">
                  <div [innerHTML]="logos.get('Rarecips_Spinner')" class="flex flex-row w-7 h-7 items-center justify-center"></div>
                </div>

              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

@if (showForgotPasswordModal) {
  <div class="fixed inset-0 z-50 flex items-center justify-center visibleBackdrop"
       style="backdrop-filter: blur(10px); background: var(--primary-backdrop);">
    <div class="modal w-96 rounded-3xl shadow-2xl p-8 relative" style="background: var(--primary-200);">
      <h2 class="text-2xl font-bold mb-4" style="color: var(--primary-700);">{{ t('change_password') }}</h2>
      <form (submit)="onForgotPasswordSubmit($event)">
        <div class="mb-4">
          <label for="forgotEmail" class="block text-sm font-semibold mb-1" style="color: var(--primary-500);">{{ t('email') }}</label>
          <input id="forgotEmail" type="email" class="w-full p-2 rounded border"
                 style="background: var(--primary-100);" [(ngModel)]="forgotEmail" name="forgotEmail" required />
        </div>
        @if (forgotPasswordError) {
          <div class="text-red-600 text-sm mb-2">{{ forgotPasswordError }}</div>
        }
        @if (forgotPasswordSuccess) {
          <div class="text-green-600 text-sm mb-2">{{ forgotPasswordSuccess }}</div>
        }
        <div class="flex justify-end gap-4 mt-6">
          <button type="button" class="btn btn-secondary" (click)="closeForgotPasswordModal($event)">{{ t('cancel') }}</button>
          <button type="submit" class="btn btn-primary rounded-2xl text-white" style="background: var(--gradient-primary)">{{ t('send_link') }}</button>
        </div>
      </form>
    </div>
  </div>
}

<app-change-password-modal
  [show]="showChangePasswordModal"
  [requireCurrentPassword]="false"
  [loading]="changePasswordLoading"
  [error]="changePasswordError"
  [success]="changePasswordSuccess"
  [showPasswordRequirements]="showPasswordRequirements"
  [strengthPercent]="strengthPercent"
  [strengthColor]="strengthColor"
  [strengthLabel]="strengthLabel"
  [strengthCriteria]="strengthCriteria"
  [showPasswordStatus]="showPasswordStatus"
  [showNewPassword]="showNewPassword"
  [showConfirmPassword]="showConfirmPassword"
  [isChangePasswordDisabled]="isChangePasswordDisabled()"
  (close)="closeChangePasswordModal()"
  (submit)="onChangePasswordSubmit($event)"
  (passwordInput)="onPasswordInput($event)"
  (confirmPasswordInput)="onConfirmPasswordInput($event)"
  (showNewPasswordChange)="showNewPassword = $event"
  (showConfirmPasswordChange)="showConfirmPasswordChange = $event"
  (showPasswordRequirementsChange)="showPasswordRequirements = $event"
></app-change-password-modal>
